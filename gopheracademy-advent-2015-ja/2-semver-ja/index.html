<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>12月2日 - Working with Semantic Versions &middot; tbd</title>
  <meta name="description" content="2015年12月2日のGopherAcademyのAdvent Calendarの日本語訳。Semantic Version">
  <meta name="format-detection" content="telephone=no">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="daikikohara" />
  <meta name="twitter:title" content="12月2日 - Working with Semantic Versions &middot; tbd">
  <meta name="twitter:description" content="2015年12月2日のGopherAcademyのAdvent Calendarの日本語訳。Semantic Version">

  
  <meta property="og:type" content="article">
  <meta property="og:title" content="12月2日 - Working with Semantic Versions &middot; tbd">
  <meta property="og:description" content="2015年12月2日のGopherAcademyのAdvent Calendarの日本語訳。Semantic Version">

  <link rel="icon" href="http://localhost:1313/favicon.ico" >
  <link rel="shortcut icon" href="http://localhost:1313/favicon.ico" >
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:1313//css/pure-min.css">
  
  
    <link rel="stylesheet" href="http://localhost:1313//css/grids-responsive-min.css">
  
  <link rel="stylesheet" href="http://localhost:1313//css/all.min.css">
</head>
<body>


<div id="container">
  <header class="header">
  <div class="header-content pure-g">
    <div class="header-content-left pure-u-1 pure-u-md-1-2">
      <a class="site-title" href="http://localhost:1313/">tbd</a>
      <span class="site-description"></span>
    </div>
    <div class="header-content-right pure-u-1 pure-u-md-1-2">
      <ul class="nav-list">
        <li class="nav-item">
          <a href="http://localhost:1313/about">About</a>
        </li>
        <li class="nav-item">
          <a href="http://localhost:1313/blog">Blog</a>
        </li>
        <li class="nav-item">
          <a href="http://localhost:1313/work">Work</a>
        </li>
      </ul>
    </div>
  </div>
</header>

  <div class="main">
    <div class="meta">
      <time class="time">31 Dec 2015, 15:09</time>
      <span class="category">
        
          categories:
          
          <a class="category-name category-name-golang" href="http://localhost:1313//categories/golang">golang</a>
        
      </span>
    </div>
    <section class="post">
      <header>
        <div class="title-single">12月2日 - Working with Semantic Versions</div>
        <div class="author">
          
          
            元記事の著者 - <strong class="author-name">Matt Farina</strong>
          
        </div>
      </header>
      <div class="description">
        

<div class='note'>※本ポストは<a href="https://blog.gopheracademy.com/">Gopher Academy</a>の<a href="https://blog.gopheracademy.com/series/advent-2015/">Advent 2015</a>の<a href="https://blog.gopheracademy.com/advent-2015/semver/">12月2日の記事</a>の日本語訳です。</div>

<p><a href="http://semver.org/">Semantic Versioning</a>(SemVer)(日本語は<a href="http://semver.org/lang/ja/">こちら</a>)はバージョン管理する際のポピュラーな方法になってきた。
インクリメンタルなリリースを可能にするだけでなく人にとっても自動化する場合でも変更の意味が推測できるような構造になっている。
このおかげでSemVerは幅広い用途で理想的なバージョン管理方法になっている。最も有名なのはパッケージ管理システムである。</p>

<p>Goでの使い方を見ていく前に、semantic versionがどのようなものかを見てみよう。</p>

<img src="http://localhost:1313/images/gopheracademy-advent-2015-ja/semver.png" alt="" class="pure-img" >

<p>上記の図はsemantic versionの一例を示している。<code>.</code>で区切られた最初の3つの数字だけのものをよく見かけるのではないだろうか。semantic versionは一般的には以下のように分けられている。</p>

<ul>
<li>メジャーナンバーはパッケージやアプリケーションのAPIが後方互換性を失って変更された場合に増加される。</li>
<li>マイナーナンバーは後方互換性を失わずに新たな機能が追加された場合に増加される。メジャーナンバーが増加した場合はマイナーナンバーは0に戻る。</li>
<li>パッチナンバーは機能の追加は無いがバグ修正を行った場合に増加される。メジャーナンバーやマイナーナンバーが増加した場合はパッチナンバーは0に戻る。</li>
<li>プレリリースは<code>-</code>の後に続く<code>.</code>で区切られた識別子である。例えば<code>1.2.3-beta.1</code>といったようなものである。これは任意のものでありプレリリースバージョンでのみ必要である。今回の場合、<code>1.2.3</code>が<code>1.2.3-beta.1</code>というプレリリースに続くリリースバージョンになるだろう。</li>
<li>最後のセクションはビルド用のメタデータである。これは<code>+</code>のあとに続く<code>.</code>で区切られた識別子である。これはプレリリースとは異なる情報であり、バージョンの優先度を決める場合には無視されるべきものである。</li>
</ul>

<p>仕様ではプレフィックスとして<code>v</code>を使うかの記載は無いが、例えば<code>v1.2.3</code>というように<code>v</code>を付けている例を見ることがあるだろう。この<code>v</code>は無視されるべきものである。</p>

<p>より詳細な情報は<a href="http://semver.org/">公式ページ</a>を参照。</p>

<p>semantic versionの性質、パースやソート、範囲や条件を考慮した比較といったものは容易に実現できる。</p>

<h2 id="semantic-versionのパース:26cdf9d4774599cdb5a154b911b7e12c">Semantic Versionのパース</h2>

<p>semantic versionを扱うためのパッケージは多数存在する。今回は<a href="https://github.com/Masterminds/semver">github.com/Masterminds/semver</a>を利用する。仕様に沿って作られていて<code>v</code>をプレフィックスとしたものもサポートし、ソートや範囲や条件との比較をテストすることもできる。条件はJavaScriptやRust等を含むその他の言語のライブラリと同様に扱うことができる。</p>

<p>以下の例はsemantic versionをパースし、パースできない場合はエラーを、問題がなかった場合はメジャーナンバーを表示するものである。</p>

<pre><code class="language-go">v, err := semver.NewVersion(&quot;1.2.3-beta.1+build345&quot;)
if err != nil {
    fmt.Println(err)
} else {
    fmt.Println(v.Major())
}
</code></pre>

<p>戻り値は多くの便利なメソッドを持った<code>semver.version</code>のインスタンスである。バージョンがsemanticでない場合、<code>semver.ErrInvalidSemVer</code>エラーを返す。</p>

<p>個々のバージョンのパースだけでなくより複雑な操作を行えるところに真価がある。</p>

<h2 id="semantic-versionのソート:26cdf9d4774599cdb5a154b911b7e12c">Semantic Versionのソート</h2>

<p>いくつかのバージョンがあったとき、それらは順番になっていないかもしれない。標準ライブラリの<code>sort</code>パッケージを使ってソートできたら素晴らしいのではないだろうか。<a href="https://github.com/Masterminds/semver">github.com/Masterminds/semver</a>ではこれができる。以下に例を示す。</p>

<pre><code class="language-go">raw := []string{&quot;1.2.3&quot;, &quot;1.0&quot;, &quot;1.0.0-alpha.1&quot; &quot;1.3&quot;, &quot;2&quot;, &quot;0.4.2&quot;,}
vs := make([]*semver.Version, len(raw))
for i, r := range raw {
    v, err := semver.NewVersion(r)
    if err != nil {
        t.Errorf(&quot;Error parsing version: %s&quot;, err)
    }

    vs[i] = v
}

sort.Sort(semver.Collection(vs))
</code></pre>

<p>この例では一連のsemantic versionが<code>semver.Version</code>のインスタンスに変換され<code>semver.Collection</code>になっている。<code>semver.Collection</code>はコレクションを並び替えるために<code>sort</code>パッケージが必要とするメソッドを持つものである。これはプレリリース情報をソート、メタデータを無視、そしてその他ソートの要素を扱うスマートな方法である。</p>

<h2 id="範囲-条件-ワイルドカード:26cdf9d4774599cdb5a154b911b7e12c">範囲、条件、ワイルドカード</h2>

<p>バージョンが範囲内にあるか、または条件を満たしているか。これはバージョンを扱う上でよくある問題だ。このチェックも可能だ。例えば以下のようなものだ。</p>

<pre><code class="language-go">c, err := semver.NewConstraint(&quot;&gt;= 1.2.3, &lt; 2.0.0, != 1.4.5&quot;)
if err != nil {
    fmt.Println(&quot;Error parsing constraint:&quot;, err)
    return
}

v, err := semver.NewVersion(&quot;1.3&quot;)
if err != nil {
    fmt.Println(&quot;Error parsing version:&quot;, err)
    return
}

a := c.Check(v)
fmt.Println(&quot;Version within constraint:&quot;, a)
</code></pre>

<p>他のツール等でバージョンの範囲を扱ったことがあれば、範囲を扱う一般的なショートカットがあることをご存知だろう。<code>semver</code>パッケージでもこれらは利用可能である。これらは以下のものを含む。</p>

<ul>
<li><code>^1.2.3</code>というメジャーバージョンの互換性を保つもの。これは<code>&gt;=1.2.3, &lt; 2.0.0</code>と等しい。これはAPIのバージョンをサポートする場合に有用である。</li>
<li><code>~1.2.3</code>というパッチレベルの変更をサポートするもの。これは<code>&gt;= 1.2.3, &lt; 1.3.0</code>と等しい。これは追加機能無しでのバグ修正をサポートする。</li>
<li><code>1.2.3 - 3.4.5</code>は範囲をサポートするもの。これは<code>&gt;= 1.2.3, &lt;= 3.4.5</code>と等しい。</li>
<li><code>x</code>や<code>X</code>、<code>*</code>といったワイルドカードを利用することもできる。例えば<code>2.x</code>, <code>1.2.x</code>や単に<code>*</code>といったものが使える。これらはその他の比較演算と一緒に使うことも単体で使うこともできる。</li>
</ul>

<h2 id="smantic-versionを始めよう:26cdf9d4774599cdb5a154b911b7e12c">Smantic Versionを始めよう</h2>

<p>もし何かをバージョン管理するならsemantic versionを使うことをお勧めする。Goのツールであれば今回紹介した<a href="https://github.com/Masterminds/semver">github.com/Masterminds/semver</a>のようなものを使えば簡単にsemantic versionを扱うことができる。もしまだsemantic versionを採用していないなら今が始めるときである。</p>

      </div>
      
      <div class="share">
        <h4>Share</h4>
        
        <a href="#" data-type="twitter" data-url="http://localhost:1313/gopheracademy-advent-2015-ja/2-semver-ja/" data-description="2015年12月2日のGopherAcademyのAdvent Calendarの日本語訳。Semantic Version" data-via="daikikohara" class="prettySocial fa fa-twitter"></a>
        
        <a href="#" data-type="facebook" data-url="http://localhost:1313/gopheracademy-advent-2015-ja/2-semver-ja/" data-title="12月2日 - Working with Semantic Versions" data-description="2015年12月2日のGopherAcademyのAdvent Calendarの日本語訳。Semantic Version" data-media="" class="prettySocial fa fa-facebook"></a>
        <a href="#" data-type="googleplus" data-url="http://localhost:1313/gopheracademy-advent-2015-ja/2-semver-ja/" data-description="2015年12月2日のGopherAcademyのAdvent Calendarの日本語訳。Semantic Version" class="prettySocial fa fa-google-plus"></a>
        <a href="http://b.hatena.ne.jp/entry/http://localhost:1313/gopheracademy-advent-2015-ja/2-semver-ja/" class="hatena-bookmark-button fa fa-hatena" data-hatena-bookmark-title="12月2日 - Working with Semantic Versions" data-hatena-bookmark-layout="simple" title="このエントリーをはてなブックマークに追加"></a>
      </div>
      
      
    </section>
  </div>
  <footer class="footer-single pure-g">
  <hr>
  <div class="pure-u-1 pure-u-md-1-2 footer-single-left">
    <a rel="license" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="http://localhost:1313/images/cc.png" />
    </a>
    Except where otherwise noted, content on this site is licensed under a <a rel="license" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.
  </div>
  <div class="pure-u-1 pure-u-md-1-2 footer-single-right">
    &#169; 2015 Daiki Kohara<br>
    Powered by <a href="https://gohugo.io/" target="_blank">hugo</a>
  </div>
</footer>
<script src="http://localhost:1313//js/all.min.js"></script>
<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<script>hljs.initHighlightingOnLoad();</script>

</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>


<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
